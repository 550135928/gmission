<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Hits for Recognizing Book Covers</title>
</head>
<style>
header {
    background-color: #23527c;
    color:white;
    text-align:center;
    padding:5px;
}
nav {
    line-height:30px;
    background-color:#eeeeee;
    height:300px;
    width:100px;
    float:left;
    padding:5px;
}
section {
    width: 70%;
    float:left;
    padding:10px;
}
aside {
    width: 30%;
    float:right;
    padding:10px;
}
footer {
    background-color:black;
    color:white;
    clear:both;
    text-align:center;
    padding:5px;
}
</style>
<script type="text/javascript" src="{{url_for('static',filename='js/jquery-2.1.1.min.js')}}"></script>
<script>
    var radio_id_list = [];
    var goToNextHit = false;
    var projectName = "/gmission";
{#    var projectName = "";#}

    function submitAnswer(){
        var answer_content = '';
        for (var i = 0; i <radio_id_list.length; i++) {
            if(!$("input[name='" +radio_id_list[i]+ "']:checked").val()) {$('#notification').text('Please answer every question! Some author list(s) is(are) not checked...'); alert(radio_id_list[i]);return;}
            if(i == radio_id_list.length - 1){
                answer_content += $("input[name='" +radio_id_list[i]+ "']:checked").val();
            } else {
                answer_content += $("input[name='" +radio_id_list[i]+ "']:checked").val()+"$";
            }
        }
        var email_address = $('#email_address').val();
        var hit_number = $('#hit_number').val();

        $.ajax({
            type: 'POST',
            url:"http://"+window.location.host+projectName+"/recognization_answer_hit",
            data:{ hit_number: hit_number, answer_content: answer_content, email_address: email_address },
            success: function(msg){
                if(msg != 'OK'){
                    alert(msg);
                    $('#notification').text('Email Error... Please refresh this task to try again...');
                }
                if(goToNextHit){
                    $('#notification').text('Submission OK. Jumping to the next hit...');

                    var url = "http://"+window.location.host+projectName+"/recognization_hit/"+email_address+"/"+hit_number;
                    window.location = url;
                }


            },
            error: function(xhr, textStatus, errorThrown){
                $('#notification').text('Submission Failed! Please check you network or try later!');
            }
        });

    }

    function submitAndGoToNextHit(){
        goToNextHit = true;
        submitAnswer();
    }

    function jumpToNextHit(){
        var email_address = $('#email_address').val();
        var hit_number = $('#hit_number').val();
        var url = "http://"+window.location.host+projectName+"/jump_to_next_recognization_hit/"+email_address+"/"+hit_number;
        window.location = url;
    }

    $(document).ready(function() {
        var author_list_string = '{{ author_list }}';
        var author_list = author_list_string.split("$");
        var radio_options_string = '';
        for (var i = 0; i < author_list.length; i++) {
            var author_content = $.trim(author_list[i]);
            var radio_id = 'radio_options'+(i);
            radio_id_list.push(radio_id);
            radio_options_string += author_content + ' <input type="radio" name="'+radio_id+'" value="1" >Yes  <input type="radio" name="'+radio_id+'" value="0" >No' + ' <br/>';
        }
        $('#insert_position').replaceWith(radio_options_string);
    })
</script>
<body>
<label for="email_address">Email:</label><input type="text" name="email_address" id="email_address" value="{{ email }}" disabled/>
<label for="credits">Credits:</label><input type="text" name="credits" id="credits" value="{{ credits }}" disabled/>
<br/>
<hr/>
<label for="hit_number">Hit Number:</label><input type="text" name="hit_number" id="hit_number" value="{{ hit_number }}" disabled/> <br/>
<font style="font-weight: bold;">Hit Value:</font> {{ hit_value }} <br/>
<font style="font-weight: bold;">Query:</font> Is(Are) the following author list(s) the correct complete author full name list? <br/>
ISBN:{{ image_name }}<br/>
<img width="30%" src="../../static/image/original/{{ image_name }}.jpg"/><br/>
<div id="options" name="options">
    <b>Options:</b><br/>
    <div id="insert_position" ></div><br/>
</div>

<hr>
<div id="notification" name="notification" style="color: red"></div>
<button style="margin-right: 5%" onclick="submitAnswer();">Submit</button> <button style="margin-right: 5%" onclick="submitAndGoToNextHit();">Submit&Next</button>
<button onclick="jumpToNextHit();">Skip</button>
</body>
</html>